<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>QSB Host Admin</title>
<style>
:root {
  --bg:#1a1a1e; --card:#2a2a2e; --text:#e0e0e0;
  --accent:#00bfff; --success:#28a745; --danger:#dc3545; --warn:#ffc107;
}
body { font-family:sans-serif; background:var(--bg); color:var(--text); padding:20px;}
h1,h2 { margin:0 0 10px; }
.card { background:var(--card); padding:20px; border-radius:8px; margin-bottom:20px;}
button { padding:10px 15px; border:none; border-radius:5px; cursor:pointer; margin:3px; color:#fff; }
.btn-primary{background:var(--accent);} .btn-success{background:var(--success);}
.btn-danger{background:var(--danger);} .btn-warn{background:var(--warn); color:#222;}
.full-width{width:100%;}
input[type=text]{width:calc(100%-22px);padding:10px;margin-bottom:10px;background:#111;border:1px solid #444;color:#fff;border-radius:5px;}
#players div{padding:8px; border-left:3px solid var(--accent); margin:5px 0; background:#111; border-radius:5px;}
</style>
</head>
<body>

<h1>QSB Host Admin Panel</h1>

<div id="loginDiv" class="card">
  <h2>Sign in as Host</h2>
  <button class="btn-primary" id="steamLoginBtn">Sign in with Steam</button>
</div>

<div id="hostPanel" class="card" style="display:none;">
  <h2>Your Lobby</h2>
  <div id="hostInfo">Loading...</div>
  <button class="btn-danger full-width" id="removeLobbyBtn">Remove Lobby from website</button>
</div>

<div class="card">
  <h2>Players</h2>
  <input type="text" id="playerName" placeholder="Player name">
  <input type="text" id="reason" placeholder="Reason (optional)">
  <div>
    <button class="btn-danger" onclick="sendCommand('/kick')">Kick</button>
    <button class="btn-danger" onclick="sendCommand('/ban')">Ban</button>
    <button class="btn-warn" onclick="sendCommand('/mute')">Mute</button>
    <button class="btn-success" onclick="sendCommand('/unmute')">Unmute</button>
    <button class="btn-success" onclick="sendCommand('/unban')">Unban</button>
  </div>
  <div id="players">Loading...</div>
</div>

<div class="card">
  <h2>Server Actions</h2>
  <button class="btn-warn" onclick="sendCommand('/serverfreeze')">Freeze Server</button>
  <button class="btn-success" onclick="sendCommand('/unserverfreeze')">Unfreeze Server</button>
  <button class="btn-danger" onclick="sendCommand('/clearchat')">Clear All Chat</button>
</div>

<script>
document.getElementById('steamLoginBtn').onclick = () => {
  window.location.href = 'https://server.ctksystem.com/qsbadmin/auth/steam';
};
// Check login status
async function checkAuth() {
  const res = await fetch('https://server.ctksystem.com/qsbadmin/auth/check');
  const data = await res.json();
  if (data.authenticated) {
    document.getElementById('loginDiv').style.display = 'none';
    document.getElementById('hostPanel').style.display = 'block';
    fetchMyLobby();
  }
}

// Fetch your lobby
async function fetchMyLobby() {
  const res = await fetch('https://server.ctksystem.com/qsbadmin/lobby');
  if (!res.ok) return document.getElementById('hostInfo').textContent = 'No active lobby';
  const lobby = await res.json();
  hostLobby = lobby;
  document.getElementById('hostInfo').innerHTML = `
    Lobby ID: ${lobby.lobbyId}<br>
    Players: ${lobby.players}/${lobby.maxPlayers}<br>
    Region: ${lobby.region}<br>
    Version: ${lobby.version}
  `;
}

// Send command
function sendCommand(prefix) {
  const player = document.getElementById('playerName').value.trim();
  const reason = document.getElementById('reason').value.trim();
  let cmd = prefix;
  if (player) cmd += ' ' + player;
  if (reason && !['/serverfreeze','/unserverfreeze','/clearchat'].includes(prefix)) cmd += ' ' + reason;

  fetch('https://server.ctksystem.com/qsbadmin/command', {
    method: 'POST',
    credentials: 'include',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ command: cmd })
  });
}

// Remove lobby button
document.getElementById('removeLobbyBtn').onclick = () => {
  fetch('https://server.ctksystem.com/qsbadmin/lobby/remove', {
    method: 'POST',
    credentials: 'include'
  }).then(() => location.reload());
};

// Init
checkAuth();
setInterval(checkAuth, 30_000); // keep session alive
</script>
</body>
</html>
