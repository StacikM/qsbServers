<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>QSB Host Admin Panel</title>
<style>
:root {
  --bg:#1a1a1e; --card:#2a2a2e; --text:#e0e0e0;
  --accent:#00bfff; --success:#28a745; --danger:#dc3545; --warn:#ffc107;
}
body { font-family:sans-serif; background:var(--bg); color:var(--text); padding:20px; margin:0; }
h1,h2 { margin:0 0 10px; }
.card { background:var(--card); padding:20px; border-radius:12px; margin-bottom:20px; box-shadow:0 2px 6px rgba(0,0,0,0.5); }
button { padding:10px 15px; border:none; border-radius:5px; cursor:pointer; margin:3px; color:#fff; }
.btn-primary{background:var(--accent);} .btn-success{background:var(--success);}
.btn-danger{background:var(--danger);} .btn-warn{background:var(--warn); color:#222;}
.full-width{width:100%;}
input[type=text]{width:calc(100%-22px);padding:10px;margin-bottom:10px;background:#111;border:1px solid #444;color:#fff;border-radius:5px;}
#players div{padding:8px; border-left:3px solid var(--accent); margin:5px 0; background:#111; border-radius:5px;}
#console {background:#111; color:#0f0; padding:10px; height:200px; overflow-y:auto; border-radius:8px; font-family:monospace; font-size:14px;}
.info-line{margin:5px 0;}
</style>
</head>
<body>
<h1>QSB Host Admin Panel</h1>

<div id="loginDiv" class="card">
  <h2>Sign in as Host</h2>
  <button class="btn-primary" id="steamLoginBtn">Sign in with Steam</button>
</div>

<div id="hostPanel" class="card" style="display:none;">
  <h2>Your Lobby</h2>
  <div class="info-line">Lobby ID: <span id="lobbyId">Loading...</span></div>
  <div class="info-line">Players: <span id="playersCount">0</span></div>
  <div class="info-line">Region: <span id="region">Unknown</span></div>
  <div class="info-line">Version: <span id="version">0</span></div>
  <div class="info-line">Uptime: <span id="uptime">0s</span></div>
  <div class="info-line">Session: <span id="sessionInfo">N/A</span></div>
  <button class="btn-danger full-width" id="removeLobbyBtn">Remove Lobby from website</button>
</div>

<div class="card">
  <h2>Send Command</h2>
  <div>
    <input type="text" id="commandInput" placeholder="Enter command...">
    <button class="btn-success" id="sendCommandBtn">Send</button>
  </div>
</div>

<div class="card">
  <h2>Command Console</h2>
  <div id="console"></div>
</div>

<script>
const backend = 'https://server.ctksystem.com';
let lobbyStart = Date.now();

function log(msg){
  const c = document.getElementById('console');
  c.innerHTML += `> ${msg}<br>`;
  c.scrollTop = c.scrollHeight;
}

async function checkAuth(){
  try{
    const res = await fetch(`${backend}/qsbadmin/auth/check`, {credentials:'include'});
    const data = await res.json();
    if(data.authenticated){
      document.getElementById('loginDiv').style.display='none';
      document.getElementById('hostPanel').style.display='block';
      document.getElementById('sessionInfo').innerText=data.steamId;
      fetchLobby();
    }
  }catch(e){log('Auth check failed');}
}

async function fetchLobby(){
  try{
    const res = await fetch(`${backend}/qsbadmin/lobby`, {credentials:'include'});
    if(!res.ok){log('No active lobby'); return;}
    const lobby = await res.json();
    document.getElementById('lobbyId').innerText=lobby.lobbyId;
    document.getElementById('playersCount').innerText=lobby.players;
    document.getElementById('region').innerText=lobby.region;
    document.getElementById('version').innerText=lobby.version;
    lobbyStart = Date.now();
  }catch(e){log('Failed to fetch lobby');}
}

document.getElementById('steamLoginBtn').onclick = () => {
  window.location.href=`${backend}/qsbadmin/auth/steam`;
};

document.getElementById('removeLobbyBtn').onclick = async () => {
  await fetch(`${backend}/qsbadmin/lobby/remove`, {method:'POST', credentials:'include'});
  location.reload();
};

document.getElementById('sendCommandBtn').onclick = async () => {
  const input = document.getElementById('commandInput');
  const cmd = input.value.trim();
  if(!cmd) return;
  try{
    await fetch(`${backend}/qsbadmin/command`, {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({command:cmd}), credentials:'include'});
    log(`Command sent: ${cmd}`);
    input.value='';
  }catch(e){log('Failed to send command');}
};

setInterval(()=>{
  fetchLobby();
  const uptimeEl=document.getElementById('uptime');
  const diff=Math.floor((Date.now()-lobbyStart)/1000);
  uptimeEl.innerText=diff+'s';
},5000);

checkAuth();
</script>
</body>
</html>
